# ç”±äºä¸€è¡Œæ³¨é‡Šï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªæŒç»­15å¹´çš„å¤§ç“œ

Hello,è¿™é‡Œæ˜¯Monster

åˆæ˜¯ä¸€ä¸ªâ€œä¹…è¿â€œçš„å‘¨æœ«ï¼Œè¿™å¤©æˆ‘æ­£åœ¨ç¿»çœ‹JUCç›¸å…³ä¹¦ç±ï¼ˆæ²¡é”™è¿˜æ˜¯Javaå¹¶å‘ç¼–ç¨‹ä¹‹ç¾ï¼‰

ç¢°å·§çœ‹åˆ°äº†CopyOnWriteArrayListï¼Œä¹¦é‡Œé¢ä»£ç çš„ä¸€è¡Œæ³¨é‡Šå¼•èµ·äº†æˆ‘çš„æ³¨æ„

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261359409.png)

â€‹	äºæ˜¯æˆ‘ç¿»å¼€äº†æˆ‘çš„IDEAï¼Œæ‰¾åˆ°äº†è¿™éƒ¨åˆ†æºç 

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261402525.png)

å¦‚ä½ æ‰€è§ï¼Œå¹¶æ²¡æœ‰è¿™è¡Œæ³¨é‡Šï¼Œä»£ç ä¹Ÿè¿›è¡Œäº†æ”¹å˜ï¼

æ˜¾è€Œæ˜“è§ï¼Œè¿™é‡Œé¢æœ‰ç“œ

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261405933.png)

æ‰“å¼€terminalï¼Œè¾“å…¥`java -version`

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261406167.png)

æœç„¶æ˜¯å› ä¸ºå‡çº§äº†JDK17çš„åŸå› 

æ—¢ç„¶å¦‚æ­¤ï¼Œåˆ‡æ¢åˆ°JDK8çœ‹ä¸€ä¸‹

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261407732.png)

æœç„¶è·Ÿä¹¦ä¸Šçš„ä¸€æ¨¡ä¸€æ ·

### ä¸ºä»€ä¹ˆè¦è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿ

ä¸å¦‚å…ˆæ¥å¯¹æ¯”ä¸€ä¸‹ä»£ç çš„åŒºåˆ«

```java
//å…¶å®æ”¹åŠ¨å°±è¿™ä¸€å¥ä»£ç 
// JDK 8
if (elements.getClass() != Object[].class)
// JDK17
if (c.getClass() != java.util.ArrayList.class)
```

**ä¸ºä»€ä¹ˆè¦å°†elementsæ¢æˆcå‘¢ï¼Ÿ**

**ä¸ºä»€ä¹ˆè¦å°†Objectæ¢æˆjava.util.ArrayListï¼Ÿ**

çœ‹æ¥éœ€è¦æ‹¿åˆ°JDKçš„gitæäº¤è®°å½•æ‰è¡Œäº†ï¼ˆå…¶å®JDK8çš„æ³¨é‡Šå·²ç»ç»™äº†ä¸€ç‚¹æŒ‡å¼•ï¼Œä½†å†™æ–‡ç« å˜›ï¼Œå¾ªåºæ¸è¿›ï¼Œç­‰ä¸‹çœ‹ğŸ¤§ï¼‰

é¦–å…ˆå»githubæ‰¾åˆ°[OpenJDK](https://github.com/openjdk/jdk)

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261445854.png)

è¡ä¸‹æ¥æºç 

```shell
git clone git@github.com:openjdk/jdk.git
```

åœ¨`src/java.base/share/classes/java/util/concurrent/`è·¯å¾„ä¸‹æ‰¾åˆ°`CopyOnWriteArrayList.java`

ç¿»åˆ°137è¡Œå¼€å§‹çš„æ„é€ å‡½æ•°ï¼Œå³é”®ä½¿ç”¨Gitè¿½æº¯æ³¨è§£

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261448671.png)

å¯ä»¥çœ‹åˆ°ï¼Œç»å†äº†ä¸‰ä¸ªå¤§ä½¬çš„è¿­ä»£ï¼Œå¹¶ä¸”æœ€è¿‘çš„ä¸€æ¬¡æ˜¯2020å¹´4æœˆ8å·Marksæäº¤çš„

é€‰ä¸­æ„é€ å‡½æ•°è¿™ä¸€éƒ¨åˆ†ä»£ç ï¼Œå³é”®Git-->æ˜¾ç¤ºé€‰å–çš„å†å²è®°å½•

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261450919.png)

ç»“æœæ˜¯è¿™æ ·çš„

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261451885.png)

å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®æ˜¯ç»æ‰‹äº†4ä½å¤§ä½¬ã€‚

Markså¤§ä½¬æœ€åå°†esä¿®æ”¹ä¸ºcï¼ŒObjectä¿®æ”¹ä¸ºjava.util.ArrayList

**ç­‰ç­‰ï¼**ä¸ºä»€ä¹ˆæ˜¯esï¼Œä¸æ˜¯elementså—ï¼Ÿ

æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï½

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261454831.png)

åŸæ¥æ˜¯leaå“¥æ”¹çš„ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œleaå“¥æ€»æ˜¯å–œæ¬¢å†™ä¸€äº›â€˜â€™è«åå…¶å¦™â€œçš„ä»£ç ï¼Œè¿™åˆæ˜¯ä¸ºå•¥å‘¢ï¼Ÿ

å…ˆä¸æ€¥ï¼Œæˆ‘ä»¬ä»å¤´å¼€å§‹ï¼Œçœ‹ä¸€ä¸‹13å¹´7æœˆ3å·çš„æäº¤

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261456208.png)

ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªä¿®æ”¹å‘¢ï¼Ÿ

åœ¨æäº¤è®°å½•çš„è¿™è¡Œï¼Œé¼ æ ‡å³é”®-->åœ¨GitHubä¸Šæ‰“å¼€

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261458449.png)

æ‰“å¼€åçš„é“¾æ¥åœ°å€ä¸ºhttps://github.com/openjdk/jdk/commit/efb561f6322b6d539d2bd8374ca53e3498b3968e

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261500078.png)

å¥½åƒæœ‰ç‚¹å¤æ‚ï¼Œä¸å¤ªå®¹æ˜“çœ‹æ˜ç™½(å…¶å®ä»è¿™é‡Œæ·±ç©¶ä¹Ÿèƒ½å‘ç°æœ€ç»ˆåŸå› ï¼Œä»æ³¨é‡Šæ›´å®¹æ˜“ä¸€ç‚¹)

çœ‹æ¥è¿˜æ˜¯ä»æ³¨é‡Šä¸‹æ‰‹æ¯”è¾ƒå®¹æ˜“

> c.toArray might (incorrectly) not return Object[] (see 6260652)

è¯´çš„å·²ç»å¾ˆæ˜ç™½ï¼Œc.toArray å¯èƒ½ä¸ä¼šè¿”å›Objectæ•°ç»„ï¼Œè¯¦è§6260652

é‚£å»æ‰¾ä¸€ä¸‹6260652è¿™ä¸ªbugå§ï¼Œåœ°å€ä¸ºhttps://bugs.openjdk.org/browse/JDK-6260652

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261505434.png)

è¿™å°±æœ‰ç‚¹å¥‡æ€ªï¼ŒtoArrayæ€ä¹ˆä¼šè¿”å›éObject[]å‘¢ï¼Ÿ

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261512089.png)

### æœ¬è´¨åŸå› æ¢ç©¶

æˆ‘ä»¬å…ˆæ¥å¤ç°ä¸€éé—®é¢˜ï¼ˆä½¿ç”¨JDK8ï¼‰

~~~java
    public static void main(String[] args) {
        Double[] strings = {0.0,1.0};
        List<Double> asList = Arrays.asList(strings);
        CopyOnWriteArrayList<Double> copy = new CopyOnWriteArrayList<>(asList);
        System.out.println(copy);
    }
~~~

åœ¨CopyOnWriteArrayListæºç å¤„æ‰“æ–­ç‚¹

ç»“æœå¾ˆAmazingå•Šï¼Œç¡®å®ä¸æ˜¯Object

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261511679.png)

å…ˆæ¥çœ‹ä¸‹JDKæ€ä¹ˆè§£å†³çš„ï¼Œæ˜¯Martin Buchholzå¤§ä½¬æäº¤çš„ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™æ¬¡æäº¤æäº¤äº†ä»€ä¹ˆ

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261518631.png)

æ‰“å¼€ååœ°å€ä¸ºï¼šhttps://github.com/openjdk/jdk/commit/57996d703c08d77bc49f8cfc315e09b45eeb5bb6

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261520745.png)

æ ¸å¿ƒä»£ç å¦‚ä¸Šå›¾å³è¾¹çº¢æ¡†ï¼Œæ€ä¹ˆç†è§£å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­æ·±ç©¶ä¸€ä¸‹

```java
public static void main(String[] args) {
        Object[] oo = {};
        List<String> list = new ArrayList<>();
        list.add("aa");
        System.out.println(list.getClass());
        System.out.println(list.toArray().getClass());
        System.out.println(list.toArray().getClass()== oo.getClass());
        System.out.println();

        list = Arrays.asList("abc");
        System.out.println(list.getClass());
        System.out.println(list.toArray().getClass());
        System.out.println(list.toArray().getClass()== oo.getClass());
        System.out.println();

        System.out.println(oo.getClass());
    }
```

ä¸å¦¨å…ˆçŒœä¸€ä¸‹ä¸Šé¢çš„è¿è¡Œç»“æœ

å®é™…è¿è¡Œç»“æœå¦‚ä¸‹

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261525769.png)

å¯ä»¥çœ‹åˆ°ä¸¤æ¬¡è¾“å‡ºlistçš„ç±»å‹éƒ½ä¸ä¸€æ ·ï¼Œ**ä¸€ä¸ªæ˜¯java.util.ArrayListï¼Œä¸€ä¸ªæ˜¯java.util.Arrays$ArrayList**

listè°ƒç”¨toArray()æ–¹æ³•åå¾—åˆ°çš„Classç±»å‹ä¹Ÿä¸ä¸€æ ·ï¼Œ**ä¸€ä¸ªæ˜¯java.lang.Object,ä¸€ä¸ªæ˜¯java.lang.String**

æ‰€ä»¥ç”¨ä»–ä»¬å’ŒObject[]çš„ç±»å‹è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¹Ÿä¸ä¸€æ ·ï¼Œä¸€ä¸ªtrueï¼Œä¸€ä¸ªfalseã€‚



**é—®é¢˜ä¸€ï¼šé‚£ä¸ºä»€ä¹ˆä¸¤æ¬¡listä¸ä¸€æ ·ï¼Ÿ**

ç¬¬ä¸€ä¸ªæ˜¯ç›´æ¥ä½¿ç”¨new ArrayList()å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä»–çš„ç±»å‹æ˜¯java.uitl.ArrayListã€‚

ç¬¬äºŒä¸ªæ˜¯ä½¿ç”¨çš„æ˜¯Arrays.asList()æ–¹æ³•åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œçœ‹æ–¹æ³•asList()çš„æºç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261533527.png)

è¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªArrayList,ä½†æ˜¯æ­¤ArrayListéå½¼ArrayListï¼Œè¿™ä¸ªè¿”å›çš„ArrayListæ˜¯Arraysè‡ªå·±çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261536806.png)

å¯ä»¥çœ‹åˆ°è¿™ä¸ªé™æ€å†…éƒ¨ç±»å®ç°äº†RandomAccessã€Serializableæ¥å£ï¼Œå³æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼Œæ”¯æŒåºåˆ—åŒ–ï¼Œè¿™å°±æ”¯æŒäº†ï¼Œå‘java.util.ArrayListçš„è½¬åŒ–ã€‚æ‰€ä»¥asList(T... a)æ–¹æ³•çš„æ³¨é‡Šä¸Šï¼Œæœ‰ä¸€å¥å¾ˆå¦™çš„è§£é‡Šï¼š

> This method acts as bridge between array-based and collection-based APIs, in combination with Collection.toArray.
>
> æ­¤æ–¹æ³•ä¸ Collection.toArray ç›¸ç»“åˆï¼Œå……å½“åŸºäºæ•°ç»„å’ŒåŸºäºé›†åˆçš„ API ä¹‹é—´çš„æ¡¥æ¢ã€‚

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261538986.png)

æ‰€ä»¥ç¬¬äºŒä¸ªlistè¾“å‡ºç±»å‹æ˜¯java.util.Arrays$ArrayList ä¹Ÿå°±æ˜¯Arraysè‡ªå·±çš„ArrayListï¼Œå¹¶ä¸”è¿™ä¸ªliståº•å±‚ä¹Ÿæ˜¯æ•°ç»„ã€‚

**é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆlistè°ƒç”¨toArray()æ–¹æ³•åå¾—åˆ°çš„Classç±»å‹ä¹Ÿä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯java.lang.Object,ä¸€ä¸ªæ˜¯java.lang.String ï¼Ÿ**

```java
public static void main(String[] args) {
        String[] s = {"a"};
        System.out.println(s.getClass());
        System.out.println();

        String[][] ss = {{"a"}};
        System.out.println(ss.getClass());
        System.out.println();

        String[] a = {"a"};
        Integer[] b = {1};
        Object[] c = {new Object()};
        System.out.println(a.getClass());
        System.out.println(b.getClass());
        System.out.println(c.getClass());
    }
```

è¾“å…¥ç»“æœå¦‚ä¸‹ï¼š

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261546169.png)

çº¢çº¿è¡¨ç¤ºçš„æ˜¯æ•°ç»„çš„ç»´åº¦ï¼Œsæ˜¯ä¸€ç»´æ•°ç»„ï¼Œ ssæ˜¯äºŒç»´æ•°ç»„

çœ‹æœ€ååä¸‰è¡Œï¼Œå‘ç°aã€bã€cè¾“å‡ºçš„æ˜¯Stringã€Integerã€Objectï¼Œè¿™è¯´æ˜äº†ä¸€ä¸ªé—®é¢˜ï¼Œ**å¯¹æ•°ç»„è¿›è¡ŒgetClass()æ–¹æ³•è°ƒç”¨ï¼Œå¾—åˆ°çš„æ˜¯æ•°ç»„ç”¨æ¥å­˜æ”¾å…ƒç´ çš„ç±»å‹**ã€‚



æœ‰äº†è¿™ä¸ªç†è®ºçŸ¥è¯†ï¼Œå›åˆ°æˆ‘ä»¬çš„é—®é¢˜ä¸­

æ¥çœ‹ç¬¬ä¸€ä¸ªï¼Œç”±ArrayListå®ä¾‹åŒ–çš„listï¼Œå®ƒçš„toArray()æ–¹æ³•æºç å¦‚ä¸‹ï¼š

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261551418.png)

è¿”å›çš„æ˜¯ä¸€ä¸ªæ˜ç¡®çš„Objectç±»å‹çš„æ•°ç»„å¯¹è±¡ï¼Œå› æ­¤è°ƒç”¨ç¬¬ä¸€ä¸ªlistçš„toArray()ååœ¨è°ƒç”¨getClass()æ–¹æ³• è¾“å‡ºçš„å°±æ˜¯java.lang.Object



å†æ¥çœ‹ç¬¬äºŒä¸ªï¼Œè¢«Arrays.asList()å®ä¾‹åŒ–åçš„listï¼Œå®ƒçš„toArray()æ–¹æ³•æºç å¦‚ä¸‹ï¼š

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261556231.png)

å¯ä»¥çœ‹åˆ°Arraysçš„ArrayListçš„toArray()æ–¹æ³•è¿”å›çš„æ˜¯ a.clone()ï¼Œè€Œaçš„å£°æ˜ç±»å‹ä¸º E [ ]ï¼Œä¹Ÿå°±æ˜¯æ³›å‹åŒ–çš„ï¼Œå³ArrayListè¢«å®ä¾‹åŒ–ä¸ºä»€ä¹ˆç±»å‹çš„ï¼Œa.clone()å°±æ˜¯ä»€ä¹ˆç±»å‹çš„ã€‚

ä»£ç ä¸­Arrays.asList("abc")ï¼Œæ˜¯String[ ]ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œè°ƒç”¨toArray()åï¼Œè¿”å›a.clone()æ–¹æ³•å¾—åˆ°çš„æ˜¯ä¸€ä¸ªString [ ], å¯¹String[ ]åœ¨è°ƒç”¨getClass()æ–¹æ³•ï¼Œå¾—åˆ°çš„å°±æ˜¯java.lang.String



æ‰€ä»¥ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆMartin Buchholzå¤§ä½¬ä¼šè¿™ä¹ˆæäº¤çš„åŸå› 

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261520745.png)

éªŒè¯ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹JDK17ä¸‹Arraysçš„toArrayçš„æºç 

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261600267.png)

æˆªæ­¢ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ä¸‹é¢ä¸¤ä¸ªæäº¤çš„åŸå› ï¼Œè¿˜å‰©ä¸‹ä¸Šé¢ä¸¤ä¸ªæäº¤çš„åŸå› æ²¡æœ‰æ·±ç©¶

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261602644.png)

å…ˆæ¥çœ‹ä¸‹Leaå“¥çš„æäº¤ï¼Œä»æäº¤è¯´æ˜æ¥çœ‹

> Improve CopyOnWriteArrayList subList code ï¼šæ”¹è¿› CopyOnWriteArrayList ä»£ç 

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261607356.png)

ä»…ä»CopyOnWriteArrayListæ„é€ å‡½æ•°æ¥çœ‹ï¼Œå°†elementsæ”¹ä¸ºäº†esã€‚

å…·ä½“åŸå› æ­¤å¤„æˆ‘å¹¶æ²¡æœ‰æ·±ç©¶ï¼ŒçŒœæµ‹æ˜¯å­—èŠ‚ç ä¼˜åŒ–

æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥äº†è§£ä¸€ä¸‹ï¼Œå‚è€ƒæ–‡ç« ï¼šhttps://www.whywhy.vip/archives/171

 

æœ€åæ¥çœ‹ä¸€ä¸‹Marksçš„æäº¤ï¼Œä»æäº¤è¯´æ˜æ¥çœ‹

> Better listing of arrays

å¥½åƒçœ‹ä¸å‡ºä»€ä¹ˆï¼Œè¿˜æ˜¯çœ‹ä»£ç å§ã€‚ã€‚ã€‚

æœ¬æ¬¡æäº¤é“¾æ¥ï¼šhttps://github.com/openjdk/jdk/commit/343ecd806bb05065d31124573b3e58a864cfc617

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261613344.png)



æœ¬åœ°æäº¤ä¸€å…±å½±å“äº†5ä¸ªç±»ï¼Œå…ˆå…³æ³¨ä¸€ä¸‹CopyOnWriteArrayListçš„ä¿®æ”¹

æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œç»è¿‡Martin Buchholzå¤§ä½¬çš„ä¼˜åŒ–ï¼Œå¦‚æœæ˜¯ä½¿ç”¨Arrays.asListï¼Œé‚£ä¹ˆè¿”å›çš„ä¹Ÿä¸€å®šæ˜¯Objectç±»å‹çš„æ•°ç»„äº†

```java
public Object[] toArray() {
	return Arrays.copyOf(a, a.length, Object[].class);
}
```

é‚£ä¹ˆå¦‚æœå°†ArrayListæˆ–è€…ç»è¿‡Arrays.asListå˜åŒ–çš„é›†åˆä¼ å…¥åˆ°CopyOnWriteArrayListçš„æ„é€ å‡½æ•°çš„å‚æ•°cä¸­

cçš„ç±»å‹å°±ä¸€å®šä¼šæ˜¯java.util.ArrayListï¼ï¼ï¼

é‚£ä¹ˆè¿™æ ·ä¿®æ”¹ä¸ä¼šè¿›å…¥`if (c.getClass() != java.util.ArrayList.class)`è¿™ä¸ªæ¡ä»¶ã€‚



è€Œå¦‚æœæ˜¯Collectionæ¥å£çš„å…¶ä»–å®ç°ç±»ï¼Œæ¯”å¦‚

```java
HashSet<String> strings = new HashSet<>();
strings.add("1");
CopyOnWriteArrayList<String> copy = new CopyOnWriteArrayList<>(strings);
```

ç›¸æ¯”äºä¸ä¿®æ”¹ä¹‹å‰ï¼Œä¼šé¢å¤–å¤šè¿›äº†ä¸€ä¸ªå¾ªç¯ï¼Œå³ä¼šè¿›å…¥`if (c.getClass() != java.util.ArrayList.class)`

è¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å…·ä½“åŸå› å¯ä»¥æ¥çœ‹ä¸‹é¢è¿™ä¸‰ä¸ªé“¾æ¥ï¼Œå·²ç»è®²çš„éå¸¸æ¸…æ¥šäº†ï¼Œä¹Ÿæˆªäº†éƒ¨åˆ†å…³é”®è¯´æ˜å›¾

https://stackoverflow.com/questions/71579092/java-priorityqueue-initelementsfromcollection-method/71584594#71584594

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261710640.png)



https://stackoverflow.com/questions/66946013/why-does-streamtolists-default-implementation-seem-overcomplicated-suboptima

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261711362.png)

https://github.com/openjdk/jdk/pull/1026

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261711609.png)

é¡ºä¾¿æä¸€å¥ï¼Œåœ¨æœ€åˆç¼–å·ä¸º6260652çš„bugä¸­ï¼Œæœ€ç»ˆæ‰§è¡Œäººä¹Ÿæ˜¯ä»–ã€‚

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261714356.png)

ä»¥ä¸Šï¼Œè¿™ä¸ªä»05-20å¹´æŒç»­15å¹´çš„bugç®—æ˜¯æ‹‰ä¸‹äº†å¸·å¹•

![](https://teamblog-1254331889.cos.ap-guangzhou.myqcloud.com/monster/202206261716471.png)